<section class="blog_section bg-white" style="padding-top: {{ section.settings.padding_top }}px; padding-bottom: {{ section.settings.padding_bottom }}px;">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">

        <!-- Section Header -->
        <div class="text-center mb-8 sm:mb-12 md:mb-16">
            {% if section.settings.section_title != blank %}
            <h2 class="text-2xl sm:text-3xl md:text-4xl font-bold text-gray-900">
                {{ section.settings.section_title }}
            </h2>
            {% endif %}

            <!-- Rating & Reviews -->
            <div class="flex flex-wrap items-center justify-center gap-4 mt-4 mb-4">
                {% if section.settings.show_rating %}
                <div class="flex items-center gap-1">
                    {% assign rating_value = section.settings.rating_value | default: 5 %}
                    {% assign full_stars = rating_value | floor %}
                    {% assign decimal_part = rating_value | modulo: 1 %}

                    {% comment %} Full stars {% endcomment %}
                    {% for i in (1..full_stars) %}
                        <svg class="w-5 h-5 text-yellow-400 fill-current" viewBox="0 0 20 20">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                        </svg>
                    {% endfor %}

                    {% comment %} Half star if decimal part >= 0.25 and < 0.75 {% endcomment %}
                    {% if decimal_part >= 0.25 and decimal_part < 0.75 %}
                        <svg class="w-5 h-5 text-yellow-400 fill-current" viewBox="0 0 20 20">
                            <defs><linearGradient id="half-star-{{ section.id }}"><stop offset="50%" stop-color="currentColor"/><stop offset="50%" stop-color="#D1D5DB"/></linearGradient></defs>
                            <path fill="url(#half-star-{{ section.id }})" d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                        </svg>
                    {% elsif decimal_part >= 0.75 %}
                        <svg class="w-5 h-5 text-yellow-400 fill-current" viewBox="0 0 20 20">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                        </svg>
                    {% endif %}

                    {% comment %} Empty stars {% endcomment %}
                    {% assign remaining = 5 | minus: rating_value %}
                    {% if decimal_part >= 0.25 and decimal_part < 0.75 %}
                        {% assign empty_stars = remaining | floor %}
                    {% elsif decimal_part >= 0.75 %}
                        {% assign empty_stars = remaining | floor %}
                    {% else %}
                        {% assign empty_stars = remaining | ceil %}
                    {% endif %}
                    {% for i in (1..empty_stars) %}
                        <svg class="w-5 h-5 text-gray-300 fill-current" viewBox="0 0 20 20">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                        </svg>
                    {% endfor %}
                </div>
                {% endif %}

                {% if section.settings.show_rating and section.settings.rating_text != blank %}
                <span class="text-sm text-gray-600 font-medium">{{ section.settings.rating_text }}</span>
                {% endif %}

                {% if section.settings.google_reviews_link != blank %}
                <a href="{{ section.settings.google_reviews_link }}" target="_blank" rel="noopener" class="inline-flex items-center gap-1.5 text-sm font-medium text-blue-600 hover:text-blue-700 transition-colors">
                    <svg class="w-4 h-4" viewBox="0 0 24 24">
                        <path fill="currentColor" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                        <path fill="currentColor" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                        <path fill="currentColor" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                        <path fill="currentColor" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                        <path fill="currentColor" d="M5.84 14.09c.87 2.6 3.3 4.53 6.16 4.53v-3.31c-1.19-.04-2.27-.58-3.1-1.4L5.84 14.09z"/>
                    </svg>
                    {{ section.settings.google_reviews_text | default: 'View Google reviews' }}
                </a>
                {% endif %}
            </div>

            {% if section.settings.section_subtitle != blank %}
            <p class="text-gray-600 mt-2 text-base sm:text-lg">
                {{ section.settings.section_subtitle }}
            </p>
            {% endif %}

            <!-- Social Icons -->
            {% if section.settings.show_social_icons %}
            <div class="flex items-center justify-center gap-3 mt-6">
                {% if section.settings.facebook_link != blank %}
                <a href="{{ section.settings.facebook_link }}" target="_blank" rel="noopener" class="w-10 h-10 flex items-center justify-center bg-gray-100 text-gray-600 rounded-full hover:bg-blue-600 hover:text-white transition-all duration-300">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 17.062 24 12.073z"/>
                    </svg>
                </a>
                {% endif %}

                {% if section.settings.instagram_link != blank %}
                <a href="{{ section.settings.instagram_link }}" target="_blank" rel="noopener" class="w-10 h-10 flex items-center justify-center bg-gray-100 text-gray-600 rounded-full hover:bg-gradient-to-br hover:from-purple-600 hover:to-pink-500 hover:text-white transition-all duration-300">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 6.78 2.618 6.98 6.98.059 1.28.073 1.689.073 4.948 0 3.259-.014 3.667-.072 4.947-.2 6.78-2.618 6.98-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-6.78-2.602-6.98-6.98-.059-1.281-.073-1.69-.073-4.949zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
                    </svg>
                </a>
                {% endif %}

                {% if section.settings.twitter_link != blank %}
                <a href="{{ section.settings.twitter_link }}" target="_blank" rel="noopener" class="w-10 h-10 flex items-center justify-center bg-gray-100 text-gray-600 rounded-full hover:bg-black hover:text-white transition-all duration-300">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
                    </svg>
                </a>
                {% endif %}

                {% if section.settings.linkedin_link != blank %}
                <a href="{{ section.settings.linkedin_link }}" target="_blank" rel="noopener" class="w-10 h-10 flex items-center justify-center bg-gray-100 text-gray-600 rounded-full hover:bg-blue-700 hover:text-white transition-all duration-300">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                    </svg>
                </a>
                {% endif %}

                {% if section.settings.youtube_link != blank %}
                <a href="{{ section.settings.youtube_link }}" target="_blank" rel="noopener" class="w-10 h-10 flex items-center justify-center bg-gray-100 text-gray-600 rounded-full hover:bg-red-600 hover:text-white transition-all duration-300">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M23.498 6.186a3.016 3.016 0 00-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505a3.017 3.017 0 00-2.122 2.136C.302 9.345 0 11.31 0 12.302c0 1.993.302 2.957.502 5.623.502 1.993 0 3.957-.302 5.623-.502a3.016 3.016 0 002.122-2.136c.373-1.872.502-3.628.502-5.623.001-1.993-.302-3.957-.502-5.623-.502zM9.655 16.98V8.704l5.617 3.138-5.617 3.138z"/>
                    </svg>
                </a>
                {% endif %}
            </div>
            {% endif %}
        </div>

        <!-- Blog Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 sm:gap-8">
            {%- comment -%} Get selected blog or auto-select 'Nieuws' or first available {%- endcomment -%}
            {%- assign blog = blogs[section.settings.blog_handle] -%}

            {%- if blog == blank -%}
                {%- comment -%} Try to use 'Nieuws' blog first {%- endcomment -%}
                {%- assign blog = blogs['nieuws'] -%}
            {%- endif -%}

            {%- if blog == blank -%}
                {%- comment -%} Fall back to first available blog {%- endcomment -%}
                {%- for blog_item in blogs -%}
                    {%- assign blog = blog_item -%}
                    {%- break -%}
                {%- endfor -%}
            {%- endif -%}

            {%- if blog != blank and blog.articles.size > 0 -%}
                {% for article in blog.articles limit: section.settings.posts_to_show %}
                <article class="relative rounded-lg overflow-hidden shadow-lg group aspect-[3/4]">
                    {% if article.image != blank %}
                    <img src="{{ article.image | image_url: width: 600, height: 800, crop: 'center' }}"
                        alt="{{ article.image.alt | default: article.title }}"
                        class="w-full h-full object-cover object-center transition-transform duration-300 group-hover:scale-105"
                        loading="lazy"
                        width="600"
                        height="800">
                    {% else %}
                    <div class="w-full h-full bg-slate-200 flex items-center justify-center">
                        <span class="text-slate-400">No image</span>
                    </div>
                    {% endif %}

                    {% if article.tags.size > 0 %}
                    <span class="absolute top-3 sm:top-4 left-3 sm:left-4 bg-slate-700 text-white text-xs font-semibold px-3 py-1.5 rounded">
                        {{ article.tags | first }}
                    </span>
                    {% endif %}

                    <div class="absolute inset-x-0 bottom-0 bg-gradient-to-t from-black via-black/80 to-transparent p-4 sm:p-6 pt-16 sm:pt-20 text-white">
                        <h3 class="text-lg sm:text-xl font-bold">{{ article.title }}</h3>
                        <a href="{{ article.url }}" class="mt-2 inline-block text-xs sm:text-sm text-slate-300 hover:underline">
                            {{ section.settings.read_more_text | default: 'sections.loopzo_blog.read_more' | t }} &rarr;
                        </a>
                    </div>
                </article>
                {% endfor %}
            {%- else -%}
                <div class="col-span-1 md:col-span-2 lg:col-span-3 text-center py-12">
                    <p class="text-slate-600 text-lg mb-4">Geen blog artikelen gevonden.</p>
                    <p class="text-slate-500 text-sm">Maak een blog aan en voeg artikelen toe in de Shopify admin.</p>
                </div>
            {%- endif -%}
        </div>

        <!-- View All Button -->
        {% if section.settings.button_text != blank and blog != blank and blog.articles.size > 0 %}
        <div class="text-center mt-12 sm:mt-16 md:mt-20">
            <a href="{{ blog.url }}" class="inline-flex items-center bg-slate-600 text-white font-bold py-2.5 sm:py-3 px-6 sm:px-8 rounded-full space-x-2.5 transition hover:bg-slate-700 text-sm sm:text-base">
                <span>{{ section.settings.button_text }}</span>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M14 5l7 7m0 0l-7 7m7-7H3" />
                </svg>
            </a>
        </div>
        {% endif %}

    </div>
</section>

{% schema %}
{
  "name": "Blog Section",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "header",
      "content": "Section Settings"
    },
    {
      "type": "text",
      "id": "section_title",
      "label": "Section Title",
      "default": "Up-to-date met Loopzo"
    },
    {
      "type": "text",
      "id": "section_subtitle",
      "label": "Section Subtitle",
      "default": "Nieuws, events & blogs"
    },
    {
      "type": "header",
      "content": "Rating Settings"
    },
    {
      "type": "checkbox",
      "id": "show_rating",
      "label": "Show rating stars",
      "default": true
    },
    {
      "type": "range",
      "id": "rating_value",
      "min": 1,
      "max": 5,
      "step": 0.1,
      "unit": "â˜…",
      "label": "Rating value",
      "default": 5
    },
    {
      "type": "text",
      "id": "rating_text",
      "label": "Rating text",
      "default": "Gebaseerd op 25+ reviews"
    },
    {
      "type": "header",
      "content": "Google Reviews Link"
    },
    {
      "type": "url",
      "id": "google_reviews_link",
      "label": "Google reviews URL",
      "info": "Link to your Google reviews page"
    },
    {
      "type": "text",
      "id": "google_reviews_text",
      "label": "Google reviews link text",
      "default": "View Google reviews"
    },
    {
      "type": "header",
      "content": "Social Media Icons"
    },
    {
      "type": "checkbox",
      "id": "show_social_icons",
      "label": "Show social icons",
      "default": true
    },
    {
      "type": "url",
      "id": "facebook_link",
      "label": "Facebook URL"
    },
    {
      "type": "url",
      "id": "instagram_link",
      "label": "Instagram URL"
    },
    {
      "type": "url",
      "id": "twitter_link",
      "label": "Twitter/X URL"
    },
    {
      "type": "url",
      "id": "linkedin_link",
      "label": "LinkedIn URL"
    },
    {
      "type": "url",
      "id": "youtube_link",
      "label": "YouTube URL"
    },
    {
      "type": "header",
      "content": "Blog Settings"
    },
    {
      "type": "blog",
      "id": "blog_handle",
      "label": "Blog",
      "info": "Select which blog to display posts from. By default, the 'Nieuws' blog will be used if available, otherwise the first available blog."
    },
    {
      "type": "text",
      "id": "read_more_text",
      "label": "Read More Text",
      "default": "Read more"
    },
    {
      "type": "range",
      "id": "posts_to_show",
      "min": 1,
      "max": 9,
      "step": 1,
      "label": "Number of posts to show",
      "default": 3
    },
    {
      "type": "header",
      "content": "Button Settings"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button Text",
      "default": "Meer nieuws"
    },
    {
      "type": "header",
      "content": "Section Spacing"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding top",
      "default": 48
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding bottom",
      "default": 80
    }
  ],
  "presets": [
    {
      "name": "Blog Section",
      "category": "Loopzo"
    }
  ]
}
{% endschema %}
