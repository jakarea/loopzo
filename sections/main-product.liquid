{%- comment -%}
  Using Tailwind CSS instead of component stylesheets
{%- endcomment -%}

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }
{%- endstyle -%}

<script src="{{ 'product-form.js' | asset_url }}" defer="defer"></script>

<!-- Breadcrumb -->
<div class="bg-slate-50 border-b border-slate-200">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-5 sm:py-6">
    <nav class="flex items-center gap-2 text-sm" aria-label="{{ 'products.product.breadcrumb' | t }}">
      <a href="{{ routes.root_url }}" class="text-slate-600 hover:text-slate-900 transition">{{ 'general.breadcrumbs.home' | t }}</a>
      <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
      </svg>
      <a href="{{ routes.all_products_collection_url }}" class="text-slate-600 hover:text-slate-900 transition">{{ 'products.product.products' | t }}</a>
      <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
      </svg>
      <span class="text-slate-900 font-medium">{{ product.title | escape }}</span>
    </nav>
  </div>
</div>

<!-- Product Info Section -->
<section class="product_info_section bg-white pt-10 sm:pt-14 md:pt-16 pb-12 sm:pb-16 md:pb-20 section-{{ section.id }}-padding">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">


    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 sm:gap-12 lg:gap-16">

      <!-- Left: Product Images -->
      <div class="relative order-1 lg:order-1 w-full">

        <!-- Sale Badge -->
        {%- if product.compare_at_price > product.price -%}
          {%- assign discount_percentage = product.compare_at_price | minus: product.price | times: 100.0 | divided_by: product.compare_at_price | round -%}
          <div class="absolute top-4 left-4 z-20 bg-red-500 text-white px-3 py-1 rounded-full text-xs sm:text-sm font-bold">
            {{ 'products.product.sale_badge' | t: percentage: discount_percentage }}
          </div>
        {%- endif -%}

        <!-- Main Image Gallery -->
        <div class="group relative w-full aspect-[4/5] sm:aspect-square overflow-hidden rounded-xl bg-gray-100 mb-4 border-2 border-gray-200">
          {%- if product.featured_media -%}
            {%- for media in product.media -%}
              <div class="slider-image absolute inset-0 transition-opacity duration-700 ease-in-out" data-slide="{{ forloop.index }}" style="opacity: {% if forloop.first %}1{% else %}0{% endif %};">
                {% render 'product-media', media: media, class: 'w-full h-full object-contain' %}
              </div>
            {%- endfor -%}
          {%- else -%}
            <div class="slider-image absolute inset-0 transition-opacity duration-700 ease-in-out" style="opacity: 1;">
              {{ 'product-1' | placeholder_svg_tag: 'w-full h-full object-contain placeholder' }}
            </div>
          {%- endif -%}

          <!-- Navigation Arrows for multiple images -->
          {%- if product.media.size > 1 -%}
            <button onclick="changeSlide(-1)" class="absolute left-3 top-1/2 -translate-y-1/2 bg-white/95 hover:bg-white text-slate-800 p-2.5 rounded-full shadow-lg transition-all duration-300 ease-in-out opacity-0 group-hover:opacity-100 hover:scale-110" aria-label="{{ 'products.product.previous_image' | t }}">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"></path>
              </svg>
            </button>
            <button onclick="changeSlide(1)" class="absolute right-3 top-1/2 -translate-y-1/2 bg-white/95 hover:bg-white text-slate-800 p-2.5 rounded-full shadow-lg transition-all duration-300 ease-in-out opacity-0 group-hover:opacity-100 hover:scale-110" aria-label="{{ 'products.product.next_image' | t }}">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"></path>
              </svg>
            </button>
          {%- endif -%}
        </div>

        <!-- Thumbnail Images -->
        {%- if product.media.size > 1 -%}
          <div class="flex gap-2 sm:gap-3">
            {%- for media in product.media -%}
              <button onclick="showSlide({{ forloop.index }})" class="{% if product.media.size <= 4 %}w-1/4{% else %}flex-1 min-w-0{% endif %} h-16 sm:h-20 rounded-lg overflow-hidden border-2 {% if forloop.first %}border-slate-600{% else %}border-transparent hover:border-slate-600{% endif %} transition" data-thumbnail="{{ forloop.index }}">
                {% render 'product-media', media: media, class: 'w-full h-full object-cover' %}
              </button>
            {%- endfor -%}
          </div>
        {%- endif -%}

        <!-- Trust Badges -->
        <div class="mt-6 grid grid-cols-3 gap-4">
          <div class="flex flex-col items-center text-center p-3 bg-slate-50 rounded-lg">
            <svg class="w-8 h-8 text-slate-700 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
            </svg>
            <span class="text-xs font-semibold text-slate-700">{{ 'products.product.trust_badges.warranty' | t }}</span>
          </div>
          <div class="flex flex-col items-center text-center p-3 bg-slate-50 rounded-lg">
            <svg class="w-8 h-8 text-slate-700 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg>
            <span class="text-xs font-semibold text-slate-700">{{ 'products.product.trust_badges.free_shipping' | t }}</span>
          </div>
          <div class="flex flex-col items-center text-center p-3 bg-slate-50 rounded-lg">
            <svg class="w-8 h-8 text-slate-700 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
            </svg>
            <span class="text-xs font-semibold text-slate-700">{{ 'products.product.trust_badges.returns' | t }}</span>
          </div>
        </div>
      </div>

      <!-- Right: Product Info -->
      <div class="flex flex-col order-2 lg:order-2">
        {%- assign product_form_id = 'product-form-' | append: section.id -%}

        <!-- Product Title -->
        <h1 class="text-2xl sm:text-3xl md:text-4xl font-bold text-gray-900 leading-tight mb-4">
          {{ product.title | escape }}
        </h1>

        <!-- Rating & Reviews -->
        {%- assign reviews_list = product.metafields.custom.product_reviews.value -%}

        {%- comment -%} Calculate review count and average rating from metaobject list {%- endcomment -%}
        {%- assign review_count = 0 -%}
        {%- assign total_rating = 0 -%}

        {%- if reviews_list != blank -%}
          {%- assign review_count = reviews_list.count -%}
          {%- for review in reviews_list -%}
            {%- assign current_rating = review.rating | plus: 0 -%}
            {%- assign total_rating = total_rating | plus: current_rating -%}
          {%- endfor -%}

          {%- if review_count > 0 -%}
            {%- assign average_rating = total_rating | times: 1.0 | divided_by: review_count | round: 1 -%}
          {%- else -%}
            {%- assign average_rating = 0 -%}
          {%- endif -%}
        {%- else -%}
          {%- assign average_rating = 0 -%}
        {%- endif -%}

        {%- if review_count > 0 -%}
          <div class="flex items-center gap-3 mb-5">
            <div class="flex items-center">
              {%- assign full_stars = average_rating | floor -%}
              {%- assign has_half_star = average_rating | minus: full_stars | at_least: 0.5 -%}
              {%- assign next_star = full_stars | plus: 1 -%}

              {%- for i in (1..5) -%}
                {%- if i <= full_stars -%}
                  <svg class="w-5 h-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M10 15.27L16.18 19l-1.64-7.03L20 7.24l-7.19-.61L10 0 7.19 6.63 0 7.24l5.46 4.73L3.82 19 10 15.27z"></path>
                  </svg>
                {%- elsif i == next_star and has_half_star > 0 -%}
                  <svg class="w-5 h-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-opacity=".3" d="M10 15.27L16.18 19l-1.64-7.03L20 7.24l-7.19-.61L10 0 7.19 6.63 0 7.24l5.46 4.73L3.82 19 10 15.27z"></path>
                  </svg>
                {%- else -%}
                  <svg class="w-5 h-5 text-slate-300" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M10 15.27L16.18 19l-1.64-7.03L20 7.24l-7.19-.61L10 0 7.19 6.63 0 7.24l5.46 4.73L3.82 19 10 15.27z"></path>
                  </svg>
                {%- endif -%}
              {%- endfor -%}
            </div>
            <span class="text-sm text-gray-600 font-medium">{{ average_rating }}</span>
            <a href="#reviews-tab" onclick="event.preventDefault(); const reviewBtn = document.querySelector('button[onclick*=reviews-tab]'); if(reviewBtn) { reviewBtn.click(); document.getElementById('reviews-tab').scrollIntoView({behavior: 'smooth', block: 'start'}); }" class="text-sm text-blue-600 hover:text-blue-800 underline cursor-pointer transition">{{ 'products.product.reviews_count' | t: count: review_count }}</a>
          </div>
        {%- endif -%}

        <!-- Price -->
        <div class="flex items-baseline gap-3 mb-5" id="price-{{ section.id }}" role="status">
          {%- assign compare_at_price = product.selected_or_first_available_variant.compare_at_price -%}
          {%- assign price = product.selected_or_first_available_variant.price -%}

          <span class="text-3xl sm:text-4xl font-bold text-slate-800">{{ price | money }}</span>

          {%- if compare_at_price > price -%}
            <span class="text-xl sm:text-2xl text-gray-400 line-through">{{ compare_at_price | money }}</span>
            {%- assign discount_percentage = compare_at_price | minus: price | times: 100.0 | divided_by: compare_at_price | round -%}
            <span class="bg-red-100 text-red-600 px-2 py-1 rounded text-sm font-semibold">{{ discount_percentage }}% OFF</span>
          {%- endif -%}
        </div>

        <!-- Stock Status -->
        {%- if section.settings.show_stock_status -%}
          {%- if product.selected_or_first_available_variant.inventory_management == 'shopify' -%}
            <div class="flex items-center gap-2 mb-6">
              {%- if product.selected_or_first_available_variant.inventory_quantity > 0 -%}
                <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                <span class="text-sm text-green-700 font-medium">
                  {%- if section.settings.show_inventory_quantity and product.selected_or_first_available_variant.inventory_quantity <= section.settings.low_stock_threshold -%}
                    {{ 'products.product.stock.low_stock' | t: quantity: product.selected_or_first_available_variant.inventory_quantity }}
                  {%- else -%}
                    {{ section.settings.in_stock_text | default: 'products.product.stock.in_stock' | t }}
                  {%- endif -%}
                </span>
              {%- else -%}
                <div class="w-2 h-2 bg-red-500 rounded-full"></div>
                <span class="text-sm text-red-700 font-medium">{{ section.settings.out_of_stock_text | default: 'products.product.stock.out_of_stock' | t }}</span>
              {%- endif -%}
            </div>
          {%- endif -%}
        {%- endif -%}

        <!-- Description -->
        {%- if product.description != blank -%}
          <div class="product__description rte text-sm sm:text-base text-gray-700 mb-6 leading-relaxed">
            {{ product.description | truncatewords: 50 }}
          </div>
        {%- endif -%}

        <!-- Key Features -->
        {%- if section.settings.show_features -%}
        <div class="mb-8 space-y-3">
          {%- if section.settings.feature_1 != blank -%}
          <div class="flex items-start gap-3">
            <svg class="w-5 h-5 text-green-600 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path>
            </svg>
            <span class="text-sm text-gray-700">{{ section.settings.feature_1 }}</span>
          </div>
          {%- endif -%}
          {%- if section.settings.feature_2 != blank -%}
          <div class="flex items-start gap-3">
            <svg class="w-5 h-5 text-green-600 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path>
            </svg>
            <span class="text-sm text-gray-700">{{ section.settings.feature_2 }}</span>
          </div>
          {%- endif -%}
          {%- if section.settings.feature_3 != blank -%}
          <div class="flex items-start gap-3">
            <svg class="w-5 h-5 text-green-600 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path>
            </svg>
            <span class="text-sm text-gray-700">{{ section.settings.feature_3 }}</span>
          </div>
          {%- endif -%}
          {%- if section.settings.feature_4 != blank -%}
          <div class="flex items-start gap-3">
            <svg class="w-5 h-5 text-green-600 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path>
            </svg>
            <span class="text-sm text-gray-700">{{ section.settings.feature_4 }}</span>
          </div>
          {%- endif -%}
        </div>
        {%- endif -%}

        <!-- Action Buttons -->
        <div class="flex flex-col gap-3">
          <form method="post" action="/cart/add" id="product-form-{{ section.id }}">
            <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
            <input type="hidden" name="quantity" value="1">
            <button
              type="submit"
              name="add"
              class="w-full border-2 border-slate-700 text-slate-700 font-bold py-3.5 px-8 rounded-lg hover:bg-slate-50 transition"
            >
              <span class="submit-button-text">{{ 'products.product.buy_now' | t }}</span>
            </button>
          </form>
        </div>

        <!-- Dynamic Expert Advisor Section -->
      {% render 'advisor-card' %}
      </div>
    </div>
  </div>
</section>

<!-- Product Tabs -->
<section class="product_tabs bg-slate-50 py-12 sm:py-16">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">

    <div class="border-b border-slate-300 mb-8">
      <div class="flex flex-wrap gap-2 sm:gap-8" role="tablist">
        <button onclick="openTab(event, 'description-tab')" class="tab-btn px-4 py-3 text-sm sm:text-base font-semibold border-b-2 border-slate-900 text-slate-900 transition">
          {{ 'products.product.tabs.description' | t }}
        </button>
        <button onclick="openTab(event, 'specifications-tab')" class="tab-btn px-4 py-3 text-sm sm:text-base font-semibold border-b-2 border-transparent text-slate-600 hover:text-slate-900 transition">
          {{ 'products.product.tabs.specifications' | t }}
        </button>
        {%- assign has_delivery_items = false -%}
        {%- for block in section.blocks -%}
          {%- if block.type == 'delivery_item' -%}
            {%- assign has_delivery_items = true -%}
            {%- break -%}
          {%- endif -%}
        {%- endfor -%}
        {%- if has_delivery_items -%}
        <button onclick="openTab(event, 'delivery-tab')" class="tab-btn px-4 py-3 text-sm sm:text-base font-semibold border-b-2 border-transparent text-slate-600 hover:text-slate-900 transition">
          {{ section.settings.delivery_heading }}
        </button>
        {%- endif -%}
        <button onclick="openTab(event, 'reviews-tab')" class="tab-btn px-4 py-3 text-sm sm:text-base font-semibold border-b-2 border-transparent text-slate-600 hover:text-slate-900 transition">
          {{ 'products.product.tabs.reviews' | t: count: review_count }}
        </button>
      </div>
    </div>

    <div class="tab-content">

      <div id="description-tab" class="tab-panel block">
        <div class="bg-white p-6 rounded-xl border border-slate-200">
          <div class="prose prose-slate max-w-none text-slate-700">
            {%- if product.description != blank -%}
              {{ product.description }}
            {%- else -%}
              <p>{{ 'products.product.tabs.no_description' | t }}</p>
            {%- endif -%}
          </div>
        </div>
      </div>

      <div id="specifications-tab" class="tab-panel hidden">
        <div class="bg-white p-6 rounded-xl border border-slate-200">
          <h3 class="text-xl font-bold text-slate-900 mb-4">{{ 'products.product.tabs.specifications_heading' | t }}</h3>
          <div class="prose prose-slate max-w-none text-slate-700">
            {%- if product.metafields.custom.specifications != blank -%}
              {{ product.metafields.custom.specifications | metafield_tag }}
            {%- else -%}
              <p class="text-slate-400 italic">{{ 'products.product.tabs.no_specifications' | t }}</p>
            {%- endif -%}
          </div>
        </div>
      </div>

      <!-- Delivery Tab -->
      {%- assign has_delivery_items = false -%}
      {%- for block in section.blocks -%}
        {%- if block.type == 'delivery_item' -%}
          {%- assign has_delivery_items = true -%}
          {%- break -%}
        {%- endif -%}
      {%- endfor -%}

      {%- if has_delivery_items -%}
      <div id="delivery-tab" class="tab-panel hidden">
        <div class="max-w-3xl">
          <h2 class="text-2xl font-bold text-slate-900 mb-6">{{ section.settings.delivery_heading }}</h2>

          <div class="space-y-6">
            {%- for block in section.blocks -%}
              {%- if block.type == 'delivery_item' -%}
                <div class="bg-white p-6 rounded-xl border border-slate-200" {{ block.shopify_attributes }}>
                  <div class="flex items-start gap-4">
                    <div class="bg-slate-100 p-3 rounded-lg">
                      {%- case block.settings.icon_type -%}
                        {%- when 'truck' -%}
                          <svg class="w-6 h-6 text-slate-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.25 18.75a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m3 0h6m-9 0H3.375a1.125 1.125 0 01-1.125-1.125V14.25m17.25 4.5a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m3 0h1.125c.621 0 1.129-.504 1.09-1.124a17.902 17.902 0 00-3.213-9.193 2.056 2.056 0 00-1.58-.86H14.25M16.5 18.75h-2.25m0-11.177v-.958c0-.568-.422-1.048-.987-1.106a48.554 48.554 0 00-10.026 0 1.106 1.106 0 00-.987 1.106v7.635m12-6.677v6.677m0 4.5v-4.5m0 0h-12"></path>
                          </svg>
                        {%- when 'tools' -%}
                          <svg class="w-6 h-6 text-slate-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                          </svg>
                        {%- when 'shield' -%}
                          <svg class="w-6 h-6 text-slate-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                          </svg>
                      {%- endcase -%}
                    </div>
                    <div class="flex-1">
                      <h3 class="text-lg font-bold text-slate-900 mb-2">{{ block.settings.title }}</h3>
                      <div class="text-slate-700 mb-3">{{ block.settings.description }}</div>
                      {%- if block.settings.link_text != blank and block.settings.link_url != blank -%}
                        <a href="{{ block.settings.link_url }}" class="text-slate-700 underline hover:text-slate-900 font-semibold">
                          {{ block.settings.link_text }}
                        </a>
                      {%- endif -%}
                    </div>
                  </div>
                </div>
              {%- endif -%}
            {%- endfor -%}
          </div>
        </div>
      </div>
      {%- endif -%}

      <div id="reviews-tab" class="tab-panel hidden">
        {%- render 'review-list', product: product -%}
      </div>

    </div>
  </div>
</section>

<script type="application/ld+json">
  {{ product | structured_data }}
</script>

<script>
let currentSlide = 1;
const totalSlides = {{ product.media.size }};

function showSlide(n) {
  if (n > totalSlides) { currentSlide = 1; }
  if (n < 1) { currentSlide = totalSlides; }
  else { currentSlide = n; }

  const slides = document.querySelectorAll('.slider-image');
  const thumbnails = document.querySelectorAll('[data-thumbnail]');

  slides.forEach((slide, index) => {
    slide.style.opacity = (index + 1) === currentSlide ? '1' : '0';
  });

  thumbnails.forEach((thumb, index) => {
    if ((index + 1) === currentSlide) {
      thumb.classList.remove('border-transparent');
      thumb.classList.add('border-slate-600');
    } else {
      thumb.classList.remove('border-slate-600');
      thumb.classList.add('border-transparent');
    }
  });
}

function changeSlide(n) {
  showSlide(currentSlide + n);
}

// Tab switcher function
function openTab(evt, tabName) {
  var i, tabcontent, tablinks;
  tabcontent = document.getElementsByClassName("tab-panel");
  for (i = 0; i < tabcontent.length; i++) {
    tabcontent[i].classList.add("hidden");
    tabcontent[i].classList.remove("block");
  }
  tablinks = document.getElementsByClassName("tab-btn");
  for (i = 0; i < tablinks.length; i++) {
    tablinks[i].classList.remove("border-slate-900", "text-slate-900");
    tablinks[i].classList.add("border-transparent", "text-slate-600");
  }
  document.getElementById(tabName).classList.remove("hidden");
  document.getElementById(tabName).classList.add("block");
  evt.currentTarget.classList.remove("border-transparent", "text-slate-600");
  evt.currentTarget.classList.add("border-slate-900", "text-slate-900");
}

// Buy Now functionality - Add to cart and redirect to checkout
document.addEventListener('DOMContentLoaded', function() {
  const productForm = document.getElementById('product-form-{{ section.id }}');
  const addingText = {{ 'products.product.adding_to_cart' | t | json }};
  const errorText = {{ 'products.product.add_to_cart_error' | t | json }};

  if (productForm) {
    productForm.addEventListener('submit', function(event) {
      event.preventDefault();

      const formData = new FormData(productForm);
      const submitButton = productForm.querySelector('button[type="submit"]');
      const buttonText = submitButton.querySelector('.submit-button-text');
      const originalText = buttonText.textContent;

      // Disable button and show loading state
      submitButton.disabled = true;
      buttonText.textContent = addingText;

      // Add product to cart
      fetch('/cart/add.js', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          id: formData.get('id'),
          quantity: parseInt(formData.get('quantity'))
        })
      })
      .then(response => response.json())
      .then(data => {
        // Redirect to checkout
        window.location.href = '/checkout';
      })
      .catch(error => {
        console.error('Error:', error);
        // Re-enable button and restore text
        submitButton.disabled = false;
        buttonText.textContent = originalText;
        alert(errorText);
      });
    });
  }
});

</script>

{% schema %}
{
  "name": "t:sections.main-product.name",
  "tag": "section",
  "class": "section",
  "blocks": [
    {
      "type": "@app"
    },
    {
      "type": "text",
      "name": "t:sections.main-product.blocks.text.name",
      "settings": [
        {
          "type": "text",
          "id": "text",
          "default": "Text block",
          "label": "t:sections.main-product.blocks.text.settings.text.label"
        },
        {
          "type": "select",
          "id": "text_style",
          "options": [
            {
              "value": "body",
              "label": "t:sections.main-product.blocks.text.settings.text_style.options__1.label"
            },
            {
              "value": "subtitle",
              "label": "t:sections.main-product.blocks.text.settings.text_style.options__2.label"
            },
            {
              "value": "uppercase",
              "label": "t:sections.main-product.blocks.text.settings.text_style.options__3.label"
            }
          ],
          "default": "body",
          "label": "t:sections.main-product.blocks.text.settings.text_style.label"
        }
      ]
    },
    {
      "type": "title",
      "name": "t:sections.main-product.blocks.title.name",
      "limit": 1
    },
    {
      "type": "price",
      "name": "t:sections.main-product.blocks.price.name",
      "limit": 1
    },
    {
      "type": "quantity_selector",
      "name": "t:sections.main-product.blocks.quantity_selector.name",
      "limit": 1
    },
    {
      "type": "variant_picker",
      "name": "t:sections.main-product.blocks.variant_picker.name",
      "limit": 1,
      "settings": [
        {
          "type": "select",
          "id": "picker_type",
          "options": [
            {
              "value": "dropdown",
              "label": "t:sections.main-product.blocks.variant_picker.settings.picker_type.options__1.label"
            },
            {
              "value": "button",
              "label": "t:sections.main-product.blocks.variant_picker.settings.picker_type.options__2.label"
            }
          ],
          "default": "button",
          "label": "t:sections.main-product.blocks.variant_picker.settings.picker_type.label"
        }
      ]
    },
    {
      "type": "buy_buttons",
      "name": "t:sections.main-product.blocks.buy_buttons.name",
      "limit": 1,
      "settings": [
        {
          "type": "checkbox",
          "id": "show_dynamic_checkout",
          "default": true,
          "label": "t:sections.main-product.blocks.buy_buttons.settings.show_dynamic_checkout.label",
          "info": "t:sections.main-product.blocks.buy_buttons.settings.show_dynamic_checkout.info"
        }
      ]
    },
    {
      "type": "description",
      "name": "t:sections.main-product.blocks.description.name",
      "limit": 1
    },
    {
      "type": "share",
      "name": "t:sections.main-product.blocks.share.name",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "share_label",
          "label": "t:sections.main-product.blocks.share.settings.share_label.label",
          "default": "Share"
        }
      ]
    },
    {
      "type": "delivery_item",
      "name": "t:sections.main-product.blocks.delivery_item.name",
      "settings": [
        {
          "type": "select",
          "id": "icon_type",
          "label": "t:sections.main-product.blocks.delivery_item.settings.icon_type.label",
          "options": [
            {
              "value": "truck",
              "label": "t:sections.main-product.blocks.delivery_item.settings.icon_type.options__1.label"
            },
            {
              "value": "tools",
              "label": "t:sections.main-product.blocks.delivery_item.settings.icon_type.options__2.label"
            },
            {
              "value": "shield",
              "label": "t:sections.main-product.blocks.delivery_item.settings.icon_type.options__3.label"
            }
          ],
          "default": "truck"
        },
        {
          "type": "text",
          "id": "title",
          "label": "t:sections.main-product.blocks.delivery_item.settings.title.label",
          "default": "Title"
        },
        {
          "type": "textarea",
          "id": "description",
          "label": "t:sections.main-product.blocks.delivery_item.settings.description.label",
          "default": "Add description here"
        },
        {
          "type": "text",
          "id": "link_text",
          "label": "t:sections.main-product.blocks.delivery_item.settings.link_text.label",
          "info": "t:sections.main-product.blocks.delivery_item.settings.link_text.info"
        },
        {
          "type": "url",
          "id": "link_url",
          "label": "t:sections.main-product.blocks.delivery_item.settings.link_url.label"
        }
      ]
    }
  ],
  "settings": [
    {
      "type": "checkbox",
      "id": "enable_sticky_info",
      "default": true,
      "label": "t:sections.main-product.settings.enable_sticky_info.label"
    },
    {
      "type": "header",
      "content": "t:sections.main-product.settings.header__stock_status"
    },
    {
      "type": "checkbox",
      "id": "show_stock_status",
      "label": "t:sections.main-product.settings.show_stock_status.label",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_inventory_quantity",
      "label": "t:sections.main-product.settings.show_inventory_quantity.label",
      "default": true,
      "info": "t:sections.main-product.settings.show_inventory_quantity.info"
    },
    {
      "type": "range",
      "id": "low_stock_threshold",
      "min": 1,
      "max": 50,
      "step": 1,
      "label": "t:sections.main-product.settings.low_stock_threshold.label",
      "default": 10,
      "info": "t:sections.main-product.settings.low_stock_threshold.info"
    },
    {
      "type": "text",
      "id": "in_stock_text",
      "label": "t:sections.main-product.settings.in_stock_text.label",
      "default": "In Stock - Ready to Ship"
    },
    {
      "type": "text",
      "id": "out_of_stock_text",
      "label": "t:sections.main-product.settings.out_of_stock_text.label",
      "default": "Out of Stock"
    },
    {
      "type": "header",
      "content": "t:sections.main-product.settings.header__product_features"
    },
    {
      "type": "checkbox",
      "id": "show_features",
      "label": "t:sections.main-product.settings.show_features.label",
      "default": true
    },
    {
      "type": "text",
      "id": "feature_1",
      "label": "t:sections.main-product.settings.feature_1.label",
      "default": "Custom-made to your specifications"
    },
    {
      "type": "text",
      "id": "feature_2",
      "label": "t:sections.main-product.settings.feature_2.label",
      "default": "Premium Dutch craftsmanship"
    },
    {
      "type": "text",
      "id": "feature_3",
      "label": "t:sections.main-product.settings.feature_3.label",
      "default": "Electric and manual options available"
    },
    {
      "type": "text",
      "id": "feature_4",
      "label": "t:sections.main-product.settings.feature_4.label",
      "default": "Free test ride included"
    },
    {
      "type": "header",
      "content": "t:sections.main-product.settings.header__delivery_tab"
    },
    {
      "type": "text",
      "id": "delivery_heading",
      "label": "t:sections.main-product.settings.delivery_heading.label",
      "default": "Levering & Montage",
      "info": "t:sections.main-product.settings.delivery_heading.info"
    },
    {
      "type": "header",
      "content": "t:sections.main-product.settings.header__padding"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.main-product.settings.padding_top.label",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.main-product.settings.padding_bottom.label",
      "default": 36
    }
  ]
}
{% endschema %}