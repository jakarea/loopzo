{% comment %}
  Featured Product Section for Home Page
  Admin selects product to feature with same design as main-product
{% endcomment %}

{%- assign product_handle = section.settings.product -%}
{%- if product_handle != blank -%}
  {%- assign product = all_products[product_handle] -%}
{%- endif -%}

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }
{%- endstyle -%}

<!-- Featured Product Section -->
<section class="featured_product_section bg-white pt-8 sm:pt-12 md:pt-16 pb-12 sm:pb-16 md:pb-20 section-{{ section.id }}-padding">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">

    <!-- Section Header -->
    {%- if section.settings.section_title != blank -%}
    <div class="text-center mb-8 sm:mb-12">
      <h2 class="text-3xl sm:text-4xl md:text-5xl font-bold text-gray-900">{{ section.settings.section_title }}</h2>
      {%- if section.settings.section_subtitle != blank -%}
      <p class="mt-3 text-lg text-gray-600">{{ section.settings.section_subtitle }}</p>
      {%- endif -%}
    </div>
    {%- endif -%}

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 sm:gap-12 lg:gap-16">

      <!-- Left: Product Images -->
      <div class="relative order-1 lg:order-1 w-full">

        <!-- Sale Badge -->
        {%- if product.compare_at_price > product.price -%}
          {%- assign discount_percentage = product.compare_at_price | minus: product.price | times: 100.0 | divided_by: product.compare_at_price | round -%}
          <div class="absolute top-4 left-4 z-20 bg-red-500 text-white px-3 py-1 rounded-full text-xs sm:text-sm font-bold">
            {{ 'products.product.sale_badge' | t: percentage: discount_percentage }}
          </div>
        {%- endif -%}

        <!-- Main Image Gallery -->
        <div class="group relative w-full aspect-[4/5] sm:aspect-square overflow-hidden rounded-xl bg-gray-100 mb-4 border-2 border-gray-200">
          {%- if product.featured_media -%}
            {%- for media in product.media -%}
              <div class="slider-image-featured absolute inset-0 transition-opacity duration-700 ease-in-out" data-slide="{{ forloop.index }}" style="opacity: {% if forloop.first %}1{% else %}0{% endif %};">
                {% render 'product-media', media: media, class: 'w-full h-full object-contain' %}
              </div>
            {%- endfor -%}
          {%- else -%}
            <div class="slider-image-featured absolute inset-0 transition-opacity duration-700 ease-in-out" style="opacity: 1;">
              {{ 'product-1' | placeholder_svg_tag: 'w-full h-full object-contain placeholder' }}
            </div>
          {%- endif -%}

          <!-- Navigation Arrows for multiple images -->
          {%- if product.media.size > 1 -%}
            <button onclick="changeSlideFeatured(-1)" class="absolute left-3 top-1/2 -translate-y-1/2 bg-white/95 hover:bg-white text-slate-800 p-2.5 rounded-full shadow-lg transition-all duration-300 ease-in-out opacity-0 group-hover:opacity-100 hover:scale-110" aria-label="{{ 'products.product.previous_image' | t }}">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"></path>
              </svg>
            </button>
            <button onclick="changeSlideFeatured(1)" class="absolute right-3 top-1/2 -translate-y-1/2 bg-white/95 hover:bg-white text-slate-800 p-2.5 rounded-full shadow-lg transition-all duration-300 ease-in-out opacity-0 group-hover:opacity-100 hover:scale-110" aria-label="{{ 'products.product.next_image' | t }}">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"></path>
              </svg>
            </button>
          {%- endif -%}
        </div>

        <!-- Thumbnail Images -->
        {%- if product.media.size > 1 -%}
          <div class="flex gap-2 sm:gap-3">
            {%- for media in product.media -%}
              <button onclick="showSlideFeatured({{ forloop.index }})" class="{% if product.media.size <= 4 %}w-1/4{% else %}flex-1 min-w-0{% endif %} h-16 sm:h-20 rounded-lg overflow-hidden border-2 {% if forloop.first %}border-slate-600{% else %}border-transparent hover:border-slate-600{% endif %} transition" data-thumbnail-featured="{{ forloop.index }}">
                {% render 'product-media', media: media, class: 'w-full h-full object-cover' %}
              </button>
            {%- endfor -%}
          </div>
        {%- endif -%}

        <!-- Trust Badges -->
        <div class="mt-6 grid grid-cols-3 gap-4">
          <div class="flex flex-col items-center text-center p-3 bg-slate-50 rounded-lg">
            <svg class="w-8 h-8 text-slate-700 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
            </svg>
            <span class="text-xs font-semibold text-slate-700">{{ 'products.product.trust_badges.warranty' | t }}</span>
          </div>
          <div class="flex flex-col items-center text-center p-3 bg-slate-50 rounded-lg">
            <svg class="w-8 h-8 text-slate-700 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg>
            <span class="text-xs font-semibold text-slate-700">{{ 'products.product.trust_badges.free_shipping' | t }}</span>
          </div>
          <div class="flex flex-col items-center text-center p-3 bg-slate-50 rounded-lg">
            <svg class="w-8 h-8 text-slate-700 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
            </svg>
            <span class="text-xs font-semibold text-slate-700">{{ 'products.product.trust_badges.returns' | t }}</span>
          </div>
        </div>
      </div>

      <!-- Right: Product Info -->
      <div class="flex flex-col order-2 lg:order-2">
        {%- assign product_form_id = 'featured-product-form-' | append: section.id -%}

        <!-- Product Title -->
        <h1 class="text-2xl sm:text-3xl md:text-4xl font-bold text-gray-900 leading-tight">
          {{ product.title | escape }}
        </h1>

        <!-- Rating & Reviews -->
        {%- assign reviews_list = product.metafields.custom.product_reviews.value -%}

        {%- comment -%} Calculate review count and average rating from metaobject list {%- endcomment -%}
        {%- assign review_count = 0 -%}
        {%- assign total_rating = 0 -%}

        {%- if reviews_list != blank -%}
          {%- assign review_count = reviews_list.count -%}
          {%- for review in reviews_list -%}
            {%- assign current_rating = review.rating | plus: 0 -%}
            {%- assign total_rating = total_rating | plus: current_rating -%}
          {%- endfor -%}

          {%- if review_count > 0 -%}
            {%- assign average_rating = total_rating | times: 1.0 | divided_by: review_count | round: 1 -%}
          {%- else -%}
            {%- assign average_rating = 0 -%}
          {%- endif -%}
        {%- else -%}
          {%- assign average_rating = 0 -%}
        {%- endif -%}

        {%- if review_count > 0 -%}
          <div class="flex items-center gap-3 mt-3">
            <div class="flex items-center">
              {%- assign full_stars = average_rating | floor -%}
              {%- assign has_half_star = average_rating | minus: full_stars | at_least: 0.5 -%}
              {%- assign next_star = full_stars | plus: 1 -%}

              {%- for i in (1..5) -%}
                {%- if i <= full_stars -%}
                  <svg class="w-5 h-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M10 15.27L16.18 19l-1.64-7.03L20 7.24l-7.19-.61L10 0 7.19 6.63 0 7.24l5.46 4.73L3.82 19 10 15.27z"></path>
                  </svg>
                {%- elsif i == next_star and has_half_star > 0 -%}
                  <svg class="w-5 h-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-opacity=".3" d="M10 15.27L16.18 19l-1.64-7.03L20 7.24l-7.19-.61L10 0 7.19 6.63 0 7.24l5.46 4.73L3.82 19 10 15.27z"></path>
                  </svg>
                {%- else -%}
                  <svg class="w-5 h-5 text-slate-300" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M10 15.27L16.18 19l-1.64-7.03L20 7.24l-7.19-.61L10 0 7.19 6.63 0 7.24l5.46 4.73L3.82 19 10 15.27z"></path>
                  </svg>
                {%- endif -%}
              {%- endfor -%}
            </div>
            <span class="text-sm text-gray-600 font-medium">{{ average_rating }}</span>
            <span class="text-sm text-gray-500">{{ 'products.product.reviews_count' | t: count: review_count }}</span>
          </div>
        {%- endif -%}

        <!-- Price -->
        <div class="flex items-baseline gap-3 mt-4" id="price-featured-{{ section.id }}" role="status">
          {%- assign compare_at_price = product.selected_or_first_available_variant.compare_at_price -%}
          {%- assign price = product.selected_or_first_available_variant.price -%}

          <span class="text-3xl sm:text-4xl font-bold text-slate-800">{{ price | money }}</span>

          {%- if compare_at_price > price -%}
            <span class="text-xl sm:text-2xl text-gray-400 line-through">{{ compare_at_price | money }}</span>
            {%- assign discount_percentage = compare_at_price | minus: price | times: 100.0 | divided_by: compare_at_price | round -%}
            <span class="bg-red-100 text-red-600 px-2 py-1 rounded text-sm font-semibold">{{ discount_percentage }}% OFF</span>
          {%- endif -%}
        </div>

        <!-- Stock Status -->
        {%- if section.settings.show_stock_status -%}
          {%- if product.selected_or_first_available_variant.inventory_management == 'shopify' -%}
            <div class="flex items-center gap-2 mt-3">
              {%- if product.selected_or_first_available_variant.inventory_quantity > 0 -%}
                <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                <span class="text-sm text-green-700 font-medium">
                  {%- if section.settings.show_inventory_quantity and product.selected_or_first_available_variant.inventory_quantity <= section.settings.low_stock_threshold -%}
                    {{ 'products.product.stock.low_stock' | t: quantity: product.selected_or_first_available_variant.inventory_quantity }}
                  {%- else -%}
                    {{ section.settings.in_stock_text | default: 'products.product.stock.in_stock' | t }}
                  {%- endif -%}
                </span>
              {%- else -%}
                <div class="w-2 h-2 bg-red-500 rounded-full"></div>
                <span class="text-sm text-red-700 font-medium">{{ section.settings.out_of_stock_text | default: 'products.product.stock.out_of_stock' | t }}</span>
              {%- endif -%}
            </div>
          {%- endif -%}
        {%- endif -%}

        <!-- Description -->
        {%- if product.description != blank -%}
          <div class="product__description rte text-sm sm:text-base text-gray-700 mt-5 leading-relaxed">
            {{ product.description | truncatewords: 50 }}
          </div>
        {%- endif -%}

        <!-- Key Features -->
        {%- if section.settings.show_features -%}
        <div class="mt-5 space-y-2">
          {%- if section.settings.feature_1 != blank -%}
          <div class="flex items-start gap-2">
            <svg class="w-5 h-5 text-green-600 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path>
            </svg>
            <span class="text-sm text-gray-700">{{ section.settings.feature_1 }}</span>
          </div>
          {%- endif -%}
          {%- if section.settings.feature_2 != blank -%}
          <div class="flex items-start gap-2">
            <svg class="w-5 h-5 text-green-600 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path>
            </svg>
            <span class="text-sm text-gray-700">{{ section.settings.feature_2 }}</span>
          </div>
          {%- endif -%}
          {%- if section.settings.feature_3 != blank -%}
          <div class="flex items-start gap-2">
            <svg class="w-5 h-5 text-green-600 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path>
            </svg>
            <span class="text-sm text-gray-700">{{ section.settings.feature_3 }}</span>
          </div>
          {%- endif -%}
          {%- if section.settings.feature_4 != blank -%}
          <div class="flex items-start gap-2">
            <svg class="w-5 h-5 text-green-600 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path>
            </svg>
            <span class="text-sm text-gray-700">{{ section.settings.feature_4 }}</span>
          </div>
          {%- endif -%}
        </div>
        {%- endif -%}

        <!-- Action Buttons -->
        <div class="flex flex-col sm:flex-row gap-3 mt-8">
          <form method="post" action="/cart/add" id="featured-product-form-{{ section.id }}" class="flex-1">
            <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
            <input type="hidden" name="quantity" value="1">
            <button
              type="submit"
              name="add"
              class="w-full bg-emerald-600 text-white font-bold py-4 px-8 rounded-lg hover:bg-emerald-700 transition-all duration-200 shadow-md hover:shadow-lg flex items-center justify-center gap-2 group"
            >
              <svg class="w-5 h-5 transition-transform group-hover:scale-110" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"/>
              </svg>
              <span class="submit-button-text">{{ 'products.product.buy_now' | t }}</span>
            </button>
          </form>
          <a href="{{ product.url }}" class="flex-1 border-2 border-slate-700 bg-white text-slate-700 font-bold py-4 px-8 rounded-lg hover:bg-slate-50 transition-all duration-200 text-center flex items-center justify-center gap-2 group">
            <span>{{ 'products.product.view_details' | t }}</span>
            <svg class="w-5 h-5 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
          </a>
        </div>

        <!-- Expert Advisor Section -->
        {%- if section.settings.show_advisor -%}
        <div class="mt-6 pt-6 border-t border-gray-200">
          <div class="bg-gradient-to-br from-slate-50 to-slate-100 rounded-lg p-4 border border-slate-200">
            <div class="flex items-start gap-3">
              <!-- Profile Image -->
              <div class="relative flex-shrink-0">
                {%- if section.settings.advisor_image != blank -%}
                  {{ section.settings.advisor_image | image_url: width: 100, height: 100 | image_tag: class: 'w-16 h-16 rounded-full object-cover shadow-lg border-2 border-white', loading: 'lazy', width: '64', height: '64', alt: section.settings.advisor_name }}
                {%- else -%}
                  <img
                    src="https://cdn.shopify.com/s/files/1/0533/2089/files/placeholder-images-user-avatar.png"
                    alt="{{ section.settings.advisor_name | escape }}"
                    class="w-16 h-16 rounded-full object-cover shadow-lg border-2 border-white"
                    loading="lazy"
                    width="64"
                    height="64"
                  >
                {%- endif -%}
                <!-- Online Status -->
                <div class="absolute bottom-0 right-0 w-4 h-4 bg-green-500 border-2 border-white rounded-full animate-pulse"></div>
              </div>

              <!-- Advisor Info -->
              <div class="flex-1">
                <h3 class="text-base font-bold text-slate-900">{{ section.settings.advisor_name }}</h3>
                {%- if section.settings.advisor_title != blank -%}
                  <p class="text-xs text-slate-600 font-medium mb-1">{{ section.settings.advisor_title }}</p>
                {%- endif -%}

                <!-- Stats -->
                <div class="flex items-center gap-3 text-xs text-slate-600 mb-2">
                  {%- if section.settings.advisor_rating != blank -%}
                    <div class="flex items-center gap-1">
                      <svg class="w-3.5 h-3.5 text-amber-500" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                      </svg>
                      <span class="font-semibold">{{ section.settings.advisor_rating }}</span>
                    </div>
                  {%- endif -%}

                  {%- if section.settings.advisor_rating != blank and section.settings.advisor_customers != blank -%}
                    <span class="text-slate-400">|</span>
                  {%- endif -%}

                  {%- if section.settings.advisor_customers != blank -%}
                    <span><strong>{{ section.settings.advisor_customers }}</strong> {{ 'products.product.happy_customers' | t }}</span>
                  {%- endif -%}
                </div>

                {%- if section.settings.advisor_quote != blank -%}
                  <p class="text-xs text-slate-700 italic">
                    "{{ section.settings.advisor_quote }}"
                  </p>
                {%- endif -%}
              </div>
            </div>

            <!-- WhatsApp CTA Button -->
            {%- if section.settings.whatsapp_link != blank -%}
              <a
                href="{{ section.settings.whatsapp_link }}"
                target="_blank"
                rel="noopener noreferrer"
                class="mt-4 w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-4 rounded-lg flex items-center justify-center gap-2 transition-all duration-300 ease-in-out shadow-md hover:shadow-lg hover:-translate-y-0.5 group"
              >
                <svg class="w-5 h-5 group-hover:scale-110 transition-transform" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"></path>
                </svg>
                <span>{{ section.settings.whatsapp_button_text }}</span>
              </a>
            {%- endif -%}

            <!-- Trust Signals -->
            {%- if section.settings.response_time_text != blank -%}
              <div class="mt-3 flex items-center justify-center gap-2 text-xs text-slate-600">
                <svg class="w-4 h-4 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                </svg>
                <span>{{ section.settings.response_time_text }}</span>
              </div>
            {%- endif -%}
          </div>
        </div>
        {%- endif -%}
      </div>

    </div>
  </div>
</section>

<script>
let currentSlideFeatured = 1;
const totalSlidesFeatured = {{ product.media.size }};

function showSlideFeatured(n) {
  if (n > totalSlidesFeatured) { currentSlideFeatured = 1; }
  if (n < 1) { currentSlideFeatured = totalSlidesFeatured; }
  else { currentSlideFeatured = n; }

  const slides = document.querySelectorAll('.slider-image-featured');
  const thumbnails = document.querySelectorAll('[data-thumbnail-featured]');

  slides.forEach((slide, index) => {
    slide.style.opacity = (index + 1) === currentSlideFeatured ? '1' : '0';
  });

  thumbnails.forEach((thumb, index) => {
    if ((index + 1) === currentSlideFeatured) {
      thumb.classList.remove('border-transparent');
      thumb.classList.add('border-slate-600');
    } else {
      thumb.classList.remove('border-slate-600');
      thumb.classList.add('border-transparent');
    }
  });
}

function changeSlideFeatured(n) {
  showSlideFeatured(currentSlideFeatured + n);
}

// Buy Now functionality - Add to cart and redirect to checkout
document.addEventListener('DOMContentLoaded', function() {
  const productForm = document.getElementById('featured-product-form-{{ section.id }}');
  const addingText = {{ 'products.product.adding_to_cart' | t | json }};
  const errorText = {{ 'products.product.add_to_cart_error' | t | json }};

  if (productForm) {
    productForm.addEventListener('submit', function(event) {
      event.preventDefault();

      const formData = new FormData(productForm);
      const submitButton = productForm.querySelector('button[type="submit"]');
      const buttonText = submitButton.querySelector('.submit-button-text');
      const originalText = buttonText.textContent;

      // Disable button and show loading state
      submitButton.disabled = true;
      buttonText.textContent = addingText;

      // Add product to cart
      fetch('/cart/add.js', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          id: formData.get('id'),
          quantity: parseInt(formData.get('quantity'))
        })
      })
      .then(response => response.json())
      .then(data => {
        // Redirect to checkout
        window.location.href = '/checkout';
      })
      .catch(error => {
        console.error('Error:', error);
        // Re-enable button and restore text
        submitButton.disabled = false;
        buttonText.textContent = originalText;
        alert(errorText);
      });
    });
  }
});

</script>

{% schema %}
{
  "name": "Loopzo Featured Product",
  "tag": "section",
  "class": "section",
  "limit": 1,
  "settings": [
    {
      "type": "header",
      "content": "Section Header"
    },
    {
      "type": "text",
      "id": "section_title",
      "label": "Section Title",
      "default": "Featured Product"
    },
    {
      "type": "text",
      "id": "section_subtitle",
      "label": "Section Subtitle",
      "default": "Discover our premium selection"
    },
    {
      "type": "header",
      "content": "Product Selection"
    },
    {
      "type": "product",
      "id": "product",
      "label": "Product",
      "info": "Select a product to feature on the home page"
    },
    {
      "type": "checkbox",
      "id": "enable_sticky_info",
      "default": true,
      "label": "t:sections.main-product.settings.enable_sticky_info.label"
    },
    {
      "type": "header",
      "content": "t:sections.main-product.settings.header__stock_status"
    },
    {
      "type": "checkbox",
      "id": "show_stock_status",
      "label": "t:sections.main-product.settings.show_stock_status.label",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_inventory_quantity",
      "label": "t:sections.main-product.settings.show_inventory_quantity.label",
      "default": true,
      "info": "t:sections.main-product.settings.show_inventory_quantity.info"
    },
    {
      "type": "range",
      "id": "low_stock_threshold",
      "min": 1,
      "max": 50,
      "step": 1,
      "label": "t:sections.main-product.settings.low_stock_threshold.label",
      "default": 10,
      "info": "t:sections.main-product.settings.low_stock_threshold.info"
    },
    {
      "type": "text",
      "id": "in_stock_text",
      "label": "t:sections.main-product.settings.in_stock_text.label",
      "default": "In Stock - Ready to Ship"
    },
    {
      "type": "text",
      "id": "out_of_stock_text",
      "label": "t:sections.main-product.settings.out_of_stock_text.label",
      "default": "Out of Stock"
    },
    {
      "type": "header",
      "content": "t:sections.main-product.settings.header__product_features"
    },
    {
      "type": "checkbox",
      "id": "show_features",
      "label": "t:sections.main-product.settings.show_features.label",
      "default": true
    },
    {
      "type": "text",
      "id": "feature_1",
      "label": "t:sections.main-product.settings.feature_1.label",
      "default": "Custom-made to your specifications"
    },
    {
      "type": "text",
      "id": "feature_2",
      "label": "t:sections.main-product.settings.feature_2.label",
      "default": "Premium Dutch craftsmanship"
    },
    {
      "type": "text",
      "id": "feature_3",
      "label": "t:sections.main-product.settings.feature_3.label",
      "default": "Electric and manual options available"
    },
    {
      "type": "text",
      "id": "feature_4",
      "label": "t:sections.main-product.settings.feature_4.label",
      "default": "Free test ride included"
    },
    {
      "type": "header",
      "content": "t:sections.main-product.settings.header__padding"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.main-product.settings.padding_top.label",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.main-product.settings.padding_bottom.label",
      "default": 36
    }
  ],
  "presets": [
    {
      "name": "Loopzo Featured Product",
      "category": "Loopzo"
    }
  ]
}
{% endschema %}
